<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.accenture.aris.inventory.business.repository.GradeRepository">
	<resultMap id="BaseResultMap"
		type="com.accenture.aris.inventory.business.entity.GradeEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<result column="testid" property="testid" jdbcType="VARCHAR" />
		<result column="cno" property="cno" jdbcType="INTEGER" />
		<result column="cname" property="cname" jdbcType="VARCHAR" />
		<result column="testname" property="testname" jdbcType="VARCHAR" />
		<result column="time" property="time" jdbcType="VARCHAR" />
		
		<result column="gradeid" property="gradeid" jdbcType="INTEGER" />
		<result column="grade" property="grade" jdbcType="INTEGER" />
		<result column="username" property="username" jdbcType="VARCHAR" />
	</resultMap>

	<select id="getTestList" resultMap="BaseResultMap"
	parameterType="java.lang.Integer">
		select
		testid,cno,cname,testname,time
		from t_grade
		where cno = #{cno}
	</select>
	
	<select id="getTestDetail" resultMap="BaseResultMap"
	parameterType="java.lang.String">
		select
		d.testid,t.cno,t.cname,t.testname,d.gradeid,d.username,d.grade
		from t_grade_detail d , t_grade t
		where t.testid=d.testid and t.testid=#{testid}
	</select>
	
	<select id="getOneDetail" resultMap="BaseResultMap"
	parameterType="java.lang.Integer">
		select
		d.testid,t.cno,t.cname,t.testname,d.gradeid,d.username,d.grade
		from t_grade_detail d , t_grade t
		where gradeid = #{gradeid} and t.testid=d.testid
	</select>
	
	<select id="getAllGradeByCnoUserid" resultMap="BaseResultMap"
	parameterType="java.lang.Integer">
		select
		t.testid as testid,cno,cname,testname,time,gradeid,username,grade
		from t_grade_detail t, t_grade g
		where t.testid = g.testid
		and cno = #{0} and t.username=(select name from t_user where id=#{1})
	</select>

	<update id="changeGrade"
		parameterType="com.accenture.aris.inventory.business.entity.GradeEntity">
		update t_grade_detail
		set grade = #{1}
		where gradeid = #{0}
	</update>

	<insert id="insertIntoGrade"
		parameterType="com.accenture.aris.inventory.business.entity.GradeEntity">
		insert into t_grade (testid,cno,cname,testname,time)
		values
		(#{testid}, #{cno},
		#{cname},#{testname},
		#{time})
	</insert>
	
	<insert id="insertIntoDetail"
		parameterType="com.accenture.aris.inventory.business.entity.GradeEntity">
		insert into t_grade_detail (testid,username)
		values
		(#{testid},#{username})
	</insert>

</mapper>